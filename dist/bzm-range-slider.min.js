"use strict";function RangeSliderHandle(a){var b=[],c=[];this.getId=function(){return a.sliderid},this.getView=function(d){return d||(d=0),a.value[d]===b[d]?c[d]:(b[d]=a.value[d],c[d]=a.formatter?a.formatter(a.value[d],a.sliderid,a.modelvalue):a.value[d],c[d])},this.getValue=function(b){return b||(b=0),a.value[b]},this.getRelative=function(b){return b||(b=0),a.relative[b]},this.setValue=function(b,c){c||(c=0),a.setValue(b)}}function bzmFoundationSlider(a,b){function c(a,c,d,e){e.$formatters.unshift(function(b){b&&(a.initdone||(a.initdone=!0,a.modelvalue=b,b.value||(b.value=a.value?a.value:[0,0]),b.title&&(a.title=b.title),b.id&&(a.sliderid=b.id)),b.byStep&&(a.byStep=parseInt(b.byStep)),b.notMore&&(a.notMore=parseInt(b.notMore)),b.notLess&&(a.notLess=parseInt(b.notLess)),b.startAt&&a.setStart(b.startAt),b.stopAt&&a.setStop(b.stopAt),void 0!==b.disabled&&(b.disabled?(a.translate(0,0),a.handles[0].css("visibility","hidden"),a.dual&&(a.translate(0,1),a.handles[1].css("visibility","hidden"))):(a.handles[0].css("visibility","visible"),a.dual&&a.handles[1].css("visibility","visible"))),void 0!==b.value&&(a.value[0]!=b.value[0]&&a.setValue(b.value[0],0),a.dual&&a.value[1]!=b.value[1]&&a.setValue(b.value[1],1)))}),a.normalize=function(b){var c=a.notMore-a.notLess,d=b*c;if(a.byStep>0){var e=(d-d%a.byStep)/a.byStep,f=d%a.byStep,g=f>=.5*a.byStep?a.byStep:0,h=e*a.byStep+g+a.notLess;return h}if(a.byStep<0){var i=Math.pow(10,-1*a.byStep),h=a.notLess+parseInt(d*i)/i;return h}return d},a.getValue=function(b,c){a.relative[c]=a.vertical?(b-a.bounds.handles[c].getBoundingClientRect().height)/(a.bounds.bar.getBoundingClientRect().height-a.bounds.handles[c].getBoundingClientRect().height):b/(a.bounds.bar.getBoundingClientRect().width-a.bounds.handles[c].getBoundingClientRect().width);var d=a.normalize(a.relative[c]);d!=a.value[c]&&(d<a.startValue&&(d=a.startValue),d>a.stopValue&&(d=a.stopValue),a.displays[c]&&(a.formatter?(a.modelvalue&&(a.modelvalue.value=a.value),a.displays[c].html(a.formatter(d,a.sliderid,a.modelvalue))):a.displays[c].html(d)),a.value[c]=d,e.$setViewValue(a.value),a.$apply(),d>a.startValue&&d<a.stopValue&&a.translate(b,c))},a.setStart=function(b){if(b>a.value[0]&&(a.dual?a.setValue(b,1):a.setValue(b,0)),a.vertical){var c=a.bounds.bar.getBoundingClientRect().height*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("height",c+"px")}else{var c=a.bounds.bar.getBoundingClientRect().width*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("width",c+"px")}a.startValue=b},a.setStop=function(b){if(b<a.value[0]&&(a.dual?a.setValue(b,1):a.setValue(b,0)),a.vertical){var c=a.bounds.bar.getBoundingClientRect().height*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("height",c+"px")}else{var c=a.bounds.bar.getBoundingClientRect().width*(b-a.notLess)/(a.notMore-a.notLess);a.stop.css({right:0,width:a.bounds.bar.getBoundingClientRect().width-c+"px"})}a.stopValue=b},a.translate=function(b,c){if(a.vertical){var d=a.bounds.bar.getBoundingClientRect().height-b;if(a.handles[c].css({"-webkit-transform":"translateY("+d+"px)","-moz-transform":"translateY("+d+"px)","-ms-transform":"translateY("+d+"px)","-o-transform":"translateY("+d+"px)",transform:"translateY("+d+"px)"}),a.dual){if(a.relative[1]&&a.relative[0]){var e=(a.relative[1]-a.relative[0])*a.bounds.bar.getBoundingClientRect().height,f=a.relative[0]*a.bounds.bar.getBoundingClientRect().height;a.slider.css({bottom:f+"px",height:e+"px"})}}else a.slider.css("height",b+"px")}else if(a.handles[c].css({"-webkit-transform":"translateX("+b+"px)","-moz-transform":"translateX("+b+"px)","-ms-transform":"translateX("+b+"px)","-o-transform":"translateX("+b+"px)",transform:"translateX("+b+"px)"}),a.dual){if(a.relative[1]&&a.relative[0]){var g=(a.relative[1]-a.relative[0])*a.bounds.bar.getBoundingClientRect().width,f=a.relative[0]*a.bounds.bar.getBoundingClientRect().width;a.slider.css({left:f+"px",width:g+"px"})}}else a.slider.css("width",b+"px")},a.setValue=function(b,c){var d;b!==a.value[c]&&(void 0===b&&(b=0),b>a.notMore&&(b=a.notMore),b<a.notLess&&(b=a.notLess),a.vertical?(a.relative[c]=(b-a.notLess)/(a.notMore-a.notLess),0===c&&(d=a.relative[c]*a.bounds.bar.getBoundingClientRect().height+a.bounds.handles[c].getBoundingClientRect().height/2),1===c&&(d=a.relative[c]*a.bounds.bar.getBoundingClientRect().height)):(a.relative[c]=(b-a.notLess)/(a.notMore-a.notLess),d=a.relative[c]*(a.bounds.bar.getBoundingClientRect().width-a.bounds.handles[c].getBoundingClientRect().width)),a.translate(d,c),a.value[c]=b,e.$setViewValue(a.formatter?a.formatter(b,a.sliderid):b),a.displays[c]&&a.displays[c].html(e.$viewValue))},a.keydown=function(b){switch(b.keyCode){case 39:case 38:a.byStep>0&&a.$apply(a.setValue(a.value[a.active]+a.byStep,a.active)),a.byStep<0&&a.$apply(a.setValue(a.value[a.active]+1/Math.pow(10,-1*a.byStep),a.active));break;case 37:case 40:a.byStep>0&&a.$apply(a.setValue(a.value[a.active]-a.byStep,a.active)),a.byStep<0&&a.$apply(a.setValue(a.value[a.active]-1/Math.pow(10,-1*a.byStep),a.active));break;case 27:a.handles[a.active][0].blur()}},a.moveHandle=function(b,c,d){var e;a.vertical?(e=a.bounds.bar.getBoundingClientRect().bottom-d,e>a.bounds.bar.getBoundingClientRect().height&&(e=a.bounds.bar.getBoundingClientRect().height),e<a.bounds.handles[b].getBoundingClientRect().height&&(e=a.bounds.handles[b].getBoundingClientRect().height)):(e=c-a.bounds.bar.getBoundingClientRect().left,0>e&&(e=0),c+a.bounds.handles[b].getBoundingClientRect().width>a.bounds.bar.getBoundingClientRect().right&&(e=a.bounds.bar.getBoundingClientRect().width-a.bounds.handles[b].getBoundingClientRect().width)),a.getValue(e,b),a.dual&&a.value[0]>a.value[1]&&(0===b?a.setValue(a.value[0],1):a.setValue(a.value[1],0))},a.focusCB=function(c){c?b.on("keydown",a.keydown):b.unbind("keydown",a.keydown)},a.touchBarCB=function(b){var c,d=0,e=b.changedTouches,f=a.value[d];if(b.preventDefault(),a.dual){c=a.vertical?(e[0].pageY-a.bounds.bar.getBoundingClientRect().bottom)/a.bounds.bar.getBoundingClientRect().height:(e[0].pageX-a.bounds.bar.getBoundingClientRect().left)/a.bounds.bar.getBoundingClientRect().width;var g=Math.abs(c-a.relative[0]),h=Math.abs(c-a.relative[1]);g>h&&(d=1)}a.moveHandle(d,e[0].pageX,e[0].pageY),a.callback&&f!==a.value[d]&&a.callback(a["export"],a.sliderid)},a.touchHandleCB=function(d,e){function f(b){b.preventDefault();for(var c=b.changedTouches,d=0;d<c.length;d++)a.moveHandle(e,c[d].pageX,c[d].pageY)}function g(){b.unbind("touchmove",f),b.unbind("touchend",g),c.on("touchstart",a.touchBarCB),a.callback&&h!==a.value[e]&&a.callback(a["export"],a.sliderid)}var h=a.value[e];d.preventDefault(),b.on("touchmove",f),b.on("touchend",g),c.unbind("touchstart",a.touchBarCB)},a.handleCB=function(c,d){function e(b){a.moveHandle(d,b.clientX,b.clientY)}function f(){b.unbind("mousemove",e),b.unbind("mouseup",f),a.callback&&g!==a.value[d]&&a.callback(a["export"],a.sliderid)}var g=a.value[d];c.preventDefault(),b.on("mousemove",e),b.on("mouseup",f),a.handles[d][0].focus(),a.active=d},a.find=function(a,b){var d;d=b?b[0].querySelector(a):c[0].querySelector(a);var e=angular.element(d);return e},a.initialSettings=function(b){var d;a.value=[],a.relative=[],null===a.precision&&(d=(""+a.byStep).match(/\.([\d]*)/),a.precision=d&&d[1]?d[1].length:0),a.bounds={bar:c[0],handles:[a.handles[0][0],a.handles[1][0]]},a.setValue(b[0],0),c.on("touchstart",a.touchBarCB),a.handles[0].on("touchstart",function(b){a.touchHandleCB(b,0)}),a.dual&&(a.handles[1].addClass("range-slider-handle"),a.handles[1].on("touchstart",function(b){a.touchHandleCB(b,1)}),a.setValue(b[1],1))},a.init=function(){if(a.sliderid=d.id||"rg-slider-"+parseInt(1e3*Math.random()),a.startValue=-1/0,a.stopValue=1/0,a.byStep=parseInt(d.byStep)||1,a.vertical=d.vertical||!1,a.dual=d.dualHandles||!1,a.trigger_input_change=!1,a.notMore=parseInt(d.notMore)||100,a.notLess=parseInt(d.notLess)||0,a.vertical&&c.addClass("vertical-range"),a.handles=[a.find(".handle-min"),a.find(".handle-max")],a.bar=c,a.slider=a.find(".range-slider-active-segment"),a.start=a.find(".bzm-range-slider-start"),a.stop=a.find(".bzm-range-slider-stop"),a["export"]=new RangeSliderHandle(a),d.displayTarget)switch(d.displayTarget){case"handle":case"handles":a.displays=a.handles,a.handles[0].addClass("bzm-range-slider-display"),a.dual&&a.handles[1].addClass("bzm-range-slider-display");break;default:a.displays=[b.getElementById(d.displayTarget)]}else a.displays=[];if(d.initial){var e=d.initial.split(",");a.initial=[void 0!==e[0]?parseInt(e[0]):a.notLess,void 0!==e[1]?parseInt(e[1]):a.notMore]}else a.initial=[a.notLess,a.notMore];a.$watch("startAt",function(){a.value<a.startAt,a.startAt&&a.setStart(a.startAt)}),a.$watch("stopAt",function(){a.value>a.stopAt,a.stopAt&&a.setStop(a.stopAt)}),a.initialSettings(a.initial)},a.init()}var d='<div class="bzm-range-slider range-slider" title="{{title}}"data-slider><span class="range-slider-handle handle-min" ng-mousedown="handleCB($event,0)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="handle-max" ng-mousedown="handleCB($event,1)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="range-slider-active-segment"></span><span class="bzm-range-slider-start" ></span> <span class="bzm-range-slider-stop"></span> <input id={{sliderid}} type="hidden"></div>';return{restrict:"E",scope:{startAt:"=",stopAt:"=",callback:"=",formatter:"=",handle:"="},require:"ngModel",template:d,replace:!0,link:c}}var RangeSlider=angular.module("bzm-range-slider",[]);RangeSlider.directive("rangeSlider",["$log","$document","$filter",bzmFoundationSlider]);