"use strict";function RangeSliderHandle(a){this.getId=function(){return a.sliderid},this.getView=function(b){return b||(b=0),a.formatter?a.formatter(a.value[b],a.sliderid):a.value[b]},this.getValue=function(b){return b||(b=0),a.value[b]},this.getRelative=function(b){return b||(b=0),a.relative[b]},this.setValue=function(b,c){c||(c=0),a.setValue(b)}}function bzmFoundationSlider(a,b){function c(c,d,e){c.normalize=function(a){var b=c.notMore-c.notLess,d=a*b;if(c.bystep>0){var e=(d-d%c.bystep)/c.bystep,f=d%c.bystep,g=f>=.5*c.bystep?c.bystep:0,h=e*c.bystep+g+c.notLess;return h}if(c.bystep<0){var i=Math.pow(10,-1*c.bystep),h=c.notLess+parseInt(d*i)/i;return h}return d},c.getValue=function(a,b){c.relative[b]=c.vertical?(a-c.bounds.handles[b].height)/(c.bounds.bar.height-c.bounds.handles[b].height):a/(c.bounds.bar.width-c.bounds.handles[b].width);var d=c.normalize(c.relative[b]);d!=c.value[b]&&(c.value[b]=d,c.displays[b]&&c.displays[b].html(c.formatter?c.formatter(d,c.sliderid):d),c.$apply())},c.setStart=function(b){if(c.vertical){var d=c.bounds.bar.height*(b-c.notLess)/(c.notMore-c.notLess);c.start.css("height",d+"px")}else{var d=c.bounds.bar.width*(b-c.notLess)/(c.notMore-c.notLess);a.log("scope.setStart elem=",c.start,"value=",b,"offset=%d",d),c.start.css("width",d+"px")}},c.setStop=function(b){if(c.vertical){var d=c.bounds.bar.height*(b-c.notLess)/(c.notMore-c.notLess);c.start.css("height",d+"px")}else{var d=c.bounds.bar.width*(b-c.notLess)/(c.notMore-c.notLess);a.log("scope.setStart elem=",c.start,"value=",b,"offset=",d),c.stop.css({right:0,width:c.bounds.bar.width-d+"px"})}},c.translate=function(b,d){if(a.log("ranslate=",c.handles[d],"handle=",d,"offset=",b),c.vertical){var e=c.bounds.bar.height-b;if(c.handles[d].css({"-webkit-transform":"translateY("+e+"px)","-moz-transform":"translateY("+e+"px)","-ms-transform":"translateY("+e+"px)","-o-transform":"translateY("+e+"px)",transform:"translateY("+e+"px)"}),c.dual){if(c.relative[1]&&c.relative[0]){var f=parseInt((c.relative[1]-c.relative[0])*c.bounds.bar.height),g=parseInt(c.relative[0]*c.bounds.bar.height);c.slider.css({bottom:g+"px",height:f+"px"})}}else c.slider.css("height",b+"px")}else if(c.handles[d].css({"-webkit-transform":"translateX("+b+"px)","-moz-transform":"translateX("+b+"px)","-ms-transform":"translateX("+b+"px)","-o-transform":"translateX("+b+"px)",transform:"translateX("+b+"px)"}),c.dual){if(c.relative[1]&&c.relative[0]){var h=parseInt((c.relative[1]-c.relative[0])*c.bounds.bar.width),g=parseInt(c.relative[0]*c.bounds.bar.width);c.slider.css({left:g+"px",width:h+"px"})}}else c.slider.css("width",b+"px")},c.setvalue=function(a,b){var d;a!==c.value[b]&&(void 0===a&&(a=0),a>c.notMore&&(a=c.notMore),a<c.notLess&&(a=c.notLess),c.vertical?(c.relative[b]=(a-c.notLess)/(c.notMore-c.notLess),d=c.relative[b]*c.bounds.bar.height+c.bounds.handles[b].height):(c.relative[b]=(a-c.notLess)/(c.notMore-c.notLess),d=c.relative[b]*c.bounds.bar.width),c.translate(d,b),c.value[b]=a,c.displays[b]&&(c.formatter?c.displays[b].html(c.formatter(a,c.sliderid)):c.display.html(a)))},c.keydown=function(a){switch(a.keyCode){case 39:case 38:c.bystep>0&&c.$apply(c.setvalue(c.value[c.active]+c.bystep,c.active)),c.bystep<0&&c.$apply(c.setvalue(c.value[c.active]+1/Math.pow(10,-1*c.bystep),c.active));break;case 37:case 40:c.bystep>0&&c.$apply(c.setvalue(c.value[c.active]-c.bystep,c.active)),c.bystep<0&&c.$apply(c.setvalue(c.value[c.active]-1/Math.pow(10,-1*c.bystep),c.active));break;case 27:c.handles[c.active][0].blur()}},c.focusCB=function(a){a?b.on("keypress",c.keydown):b.unbind("keypress",c.keydown)},c.handleCB=function(a,d){function e(a){var b;c.vertical?(b=c.bounds.bar.bottom-a.clientY,b>c.bounds.bar.height&&(b=c.bounds.bar.height),b<c.bounds.handles[d].height&&(b=c.bounds.handles[d].height)):(b=a.clientX-c.bounds.bar.left,b+c.bounds.handles[d].width>c.bounds.bar.width&&(b=c.bounds.bar.width-c.bounds.handles[d].width)),0>b&&(b=0),c.translate(b,d),c.getValue(b,d)}function f(){b.unbind("mousemove",e),b.unbind("mouseup",f),c.callback&&g!==c.value[d]&&c.callback(c.ngModel,c.sliderid)}var g=c.value[d];a.preventDefault(),b.on("mousemove",e),b.on("mouseup",f),c.handles[d][0].focus(),c.active=d},c.find=function(a,b){var c;c=b?b[0].querySelector(a):d[0].querySelector(a);var e=angular.element(c);return e},c.initialSettings=function(a){var b;c.value=[],c.relative=[],null===c.precision&&(b=(""+c.bystep).match(/\.([\d]*)/),c.precision=b&&b[1]?b[1].length:0),c.bounds={bar:d[0].getBoundingClientRect(),handles:[c.handles[0][0].getBoundingClientRect(),c.handles[1][0].getBoundingClientRect()]},c.setvalue(a[0],0),c.dual&&(c.handles[1].addClass("range-slider-handle"),c.setvalue(a[1],1))},c.init=function(){if(a.log("scope=",c),c.sliderid=e.id||"range-slide-"+parseInt(1e3*Math.random()),c.bystep=parseInt(e.byStep)||1,c.vertical=e.vertical||!1,c.dual=e.dualHandles||!1,c.trigger_input_change=!1,c.notMore=parseInt(e.notMore)||100,c.notLess=parseInt(e.notLess)||0,e.initial){var f=e.initial.split(",");c.initial=[parseInt(f[0])||c.notLess,parseInt(f[1])||c.notMore]}else c.initial=[c.notLess,c.notMore];if(c.vertical&&d.addClass("vertical-range"),e.format&&(c.format=e.format.split("|")),c.handles=[c.find(".handle-min"),c.find(".handle-max")],c.slider=c.find(".range-slider-active-segment"),c.start=c.find(".bzm-range-slider-start"),c.stop=c.find(".bzm-range-slider-stop"),c.ngModel=new RangeSliderHandle(c),e.displayTarget)switch(e.displayTarget){case"handle":case"handles":c.displays=c.handles;break;default:c.displays=[b.getElementById(e.displayTarget)]}else c.displays=[];c.initialSettings(c.initial),c.$watch("startAt",function(){c.value<c.startAt,c.startAt&&c.setStart(c.startAt)}),c.$watch("stopAt",function(){c.value>c.stopAt,c.stopAt&&c.setStop(c.stopAt)})},c.init()}var d='<div class="bzm-range-slider range-slider" data-slider><span class="range-slider-handle handle-min" ng-mousedown="handleCB($event,0)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="handle-max" ng-mousedown="handleCB($event,1)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="range-slider-active-segment"></span><span class="bzm-range-slider-start" ></span> <span class="bzm-range-slider-stop"></span> <input type="hidden"></div>';return{restrict:"E",scope:{ngModel:"=",startAt:"=",stopAt:"=",callback:"=",formatter:"="},template:d,require:"ngModel",replace:!0,link:c}}var RangeSlider=angular.module("bzm-range-slider",[]);RangeSlider.directive("rangeSlider",["$log","$document","$filter",bzmFoundationSlider]);