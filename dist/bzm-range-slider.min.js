"use strict";function RangeSliderHandle(a){var b=[],c=[];this.getId=function(){return a.sliderid},this.getView=function(d){return d||(d=0),a.value[d]===b[d]?c[d]:(b[d]=a.value[d],c[d]=a.formatter?a.formatter(a.value[d],a.sliderid):a.value[d],c[d])},this.getValue=function(b){return b||(b=0),a.value[b]},this.getRelative=function(b){return b||(b=0),a.relative[b]},this.setValue=function(b,c){c||(c=0),a.setValue(b)}}function bzmFoundationSlider(a,b){function c(c,d,e,f){f.$formatters.unshift(function(b){b&&(b.title&&!c.titledone&&(c.title=b.title,c.titledone=!0),b.byStep&&(c.byStep=parseInt(b.byStep)),b.notMore&&(c.notMore=parseInt(b.notMore)),b.notLess&&(c.notLess=parseInt(b.notLess)),b.startAt&&c.setStart(b.startAt),b.stopAt&&c.setStop(b.stopAt),a.log("slider formatter id=%d value=%s",c.sliderid,b.value),b.value&&(c.dual?(b.value[0]!=b.value[0]&&c.setValue(b.value[0],0),b.value[1]!=b.value[0]&&c.setValue(b.value[1],1)):b.value!=b.value[0]&&c.setValue(b.value,0)))}),c.normalize=function(a){var b=c.notMore-c.notLess,d=a*b;if(c.byStep>0){var e=(d-d%c.byStep)/c.byStep,f=d%c.byStep,g=f>=.5*c.byStep?c.byStep:0,h=e*c.byStep+g+c.notLess;return h}if(c.byStep<0){var i=Math.pow(10,-1*c.byStep),h=c.notLess+parseInt(d*i)/i;return h}return d},c.getValue=function(a,b){c.relative[b]=c.vertical?(a-c.bounds.handles[b].getBoundingClientRect().height)/(c.bounds.bar.getBoundingClientRect().height-c.bounds.handles[b].getBoundingClientRect().height):a/(c.bounds.bar.getBoundingClientRect().width-c.bounds.handles[b].getBoundingClientRect().width);var d=c.normalize(c.relative[b]);d!=c.value[b]&&(d<c.startValue&&(d=c.startValue),d>c.stopValue&&(d=c.stopValue),c.displays[b]&&c.displays[b].html(c.formatter?c.formatter(d,c.sliderid):d),c.value[b]=d,f.$setViewValue(c.value),c.$apply(),d>c.startValue&&d<c.stopValue&&c.translate(a,b))},c.setStart=function(a){if(a>c.value[0]&&(c.dual?c.setValue(a,1):c.setValue(a,0)),c.vertical){var b=c.bounds.bar.getBoundingClientRect().height*(a-c.notLess)/(c.notMore-c.notLess);c.start.css("height",b+"px")}else{var b=c.bounds.bar.getBoundingClientRect().width*(a-c.notLess)/(c.notMore-c.notLess);c.start.css("width",b+"px")}c.startValue=a},c.setStop=function(a){if(a<c.value[0]&&(c.dual?c.setValue(a,1):c.setValue(a,0)),c.vertical){var b=c.bounds.bar.getBoundingClientRect().height*(a-c.notLess)/(c.notMore-c.notLess);c.start.css("height",b+"px")}else{var b=c.bounds.bar.getBoundingClientRect().width*(a-c.notLess)/(c.notMore-c.notLess);c.stop.css({right:0,width:c.bounds.bar.getBoundingClientRect().width-b+"px"})}c.stopValue=a},c.translate=function(a,b){if(c.vertical){var d=c.bounds.bar.getBoundingClientRect().height-a;if(c.handles[b].css({"-webkit-transform":"translateY("+d+"px)","-moz-transform":"translateY("+d+"px)","-ms-transform":"translateY("+d+"px)","-o-transform":"translateY("+d+"px)",transform:"translateY("+d+"px)"}),c.dual){if(c.relative[1]&&c.relative[0]){var e=(c.relative[1]-c.relative[0])*c.bounds.bar.getBoundingClientRect().height,f=c.relative[0]*c.bounds.bar.getBoundingClientRect().height;c.slider.css({bottom:f+"px",height:e+"px"})}}else c.slider.css("height",a+"px")}else if(c.handles[b].css({"-webkit-transform":"translateX("+a+"px)","-moz-transform":"translateX("+a+"px)","-ms-transform":"translateX("+a+"px)","-o-transform":"translateX("+a+"px)",transform:"translateX("+a+"px)"}),c.dual){if(c.relative[1]&&c.relative[0]){var g=(c.relative[1]-c.relative[0])*c.bounds.bar.getBoundingClientRect().width,f=c.relative[0]*c.bounds.bar.getBoundingClientRect().width;c.slider.css({left:f+"px",width:g+"px"})}}else c.slider.css("width",a+"px")},c.setValue=function(a,b){var d;a!==c.value[b]&&(void 0===a&&(a=0),a>c.notMore&&(a=c.notMore),a<c.notLess&&(a=c.notLess),c.vertical?(c.relative[b]=(a-c.notLess)/(c.notMore-c.notLess),0===b&&(d=c.relative[b]*c.bounds.bar.getBoundingClientRect().height+c.bounds.handles[b].getBoundingClientRect().height/2),1===b&&(d=c.relative[b]*c.bounds.bar.getBoundingClientRect().height)):(c.relative[b]=(a-c.notLess)/(c.notMore-c.notLess),d=c.relative[b]*(c.bounds.bar.getBoundingClientRect().width-c.bounds.handles[b].getBoundingClientRect().width)),c.translate(d,b),c.value[b]=a,f.$setViewValue(c.formatter?c.formatter(a,c.sliderid):a),c.displays[b]&&c.displays[b].html(f.$viewValue))},c.keydown=function(a){switch(a.keyCode){case 39:case 38:c.byStep>0&&c.$apply(c.setValue(c.value[c.active]+c.byStep,c.active)),c.byStep<0&&c.$apply(c.setValue(c.value[c.active]+1/Math.pow(10,-1*c.byStep),c.active));break;case 37:case 40:c.byStep>0&&c.$apply(c.setValue(c.value[c.active]-c.byStep,c.active)),c.byStep<0&&c.$apply(c.setValue(c.value[c.active]-1/Math.pow(10,-1*c.byStep),c.active));break;case 27:c.handles[c.active][0].blur()}},c.moveHandle=function(a,b,d){var e;c.vertical?(e=c.bounds.bar.getBoundingClientRect().bottom-d,e>c.bounds.bar.getBoundingClientRect().height&&(e=c.bounds.bar.getBoundingClientRect().height),e<c.bounds.handles[a].getBoundingClientRect().height&&(e=c.bounds.handles[a].getBoundingClientRect().height)):(e=b-c.bounds.bar.getBoundingClientRect().left,0>e&&(e=0),b+c.bounds.handles[a].getBoundingClientRect().width>c.bounds.bar.getBoundingClientRect().right&&(e=c.bounds.bar.getBoundingClientRect().width-c.bounds.handles[a].getBoundingClientRect().width)),c.getValue(e,a),c.dual&&c.value[0]>c.value[1]&&(0===a?c.setValue(c.value[0],1):c.setValue(c.value[1],0))},c.focusCB=function(a){a?b.on("keydown",c.keydown):b.unbind("keydown",c.keydown)},c.touchBarCB=function(a){var b,d=0,e=a.changedTouches,f=c.value[d];if(a.preventDefault(),c.dual){b=c.vertical?(e[0].pageY-c.bounds.bar.getBoundingClientRect().bottom)/c.bounds.bar.getBoundingClientRect().height:(e[0].pageX-c.bounds.bar.getBoundingClientRect().left)/c.bounds.bar.getBoundingClientRect().width;var g=Math.abs(b-c.relative[0]),h=Math.abs(b-c.relative[1]);g>h&&(d=1)}c.moveHandle(d,e[0].pageX,e[0].pageY),c.callback&&f!==c.value[d]&&c.callback(c["export"],c.sliderid)},c.touchHandleCB=function(a,e){function f(a){a.preventDefault();for(var b=a.changedTouches,d=0;d<b.length;d++)c.moveHandle(e,b[d].pageX,b[d].pageY)}function g(){b.unbind("touchmove",f),b.unbind("touchend",g),d.on("touchstart",c.touchBarCB),c.callback&&h!==c.value[e]&&c.callback(c["export"],c.sliderid)}var h=c.value[e];a.preventDefault(),b.on("touchmove",f),b.on("touchend",g),d.unbind("touchstart",c.touchBarCB)},c.handleCB=function(a,d){function e(a){c.moveHandle(d,a.clientX,a.clientY)}function f(){b.unbind("mousemove",e),b.unbind("mouseup",f),c.callback&&g!==c.value[d]&&c.callback(c["export"],c.sliderid)}var g=c.value[d];a.preventDefault(),b.on("mousemove",e),b.on("mouseup",f),c.handles[d][0].focus(),c.active=d},c.find=function(a,b){var c;c=b?b[0].querySelector(a):d[0].querySelector(a);var e=angular.element(c);return e},c.initialSettings=function(a){var b;c.value=[],c.relative=[],null===c.precision&&(b=(""+c.byStep).match(/\.([\d]*)/),c.precision=b&&b[1]?b[1].length:0),c.bounds={bar:d[0],handles:[c.handles[0][0],c.handles[1][0]]},c.setValue(a[0],0),d.on("touchstart",c.touchBarCB),c.handles[0].on("touchstart",function(a){c.touchHandleCB(a,0)}),c.dual&&(c.handles[1].addClass("range-slider-handle"),c.handles[1].on("touchstart",function(a){c.touchHandleCB(a,1)}),c.setValue(a[1],1))},c.init=function(){if(c.sliderid=e.id||"rg-slider-"+parseInt(1e3*Math.random()),c.startValue=-1/0,c.stopValue=1/0,c.byStep=parseInt(e.byStep)||1,c.vertical=e.vertical||!1,c.dual=e.dualHandles||!1,c.trigger_input_change=!1,c.notMore=parseInt(e.notMore)||100,c.notLess=parseInt(e.notLess)||0,c.vertical&&d.addClass("vertical-range"),c.handles=[c.find(".handle-min"),c.find(".handle-max")],c.bar=d,c.slider=c.find(".range-slider-active-segment"),c.start=c.find(".bzm-range-slider-start"),c.stop=c.find(".bzm-range-slider-stop"),c["export"]=new RangeSliderHandle(c),e.displayTarget)switch(e.displayTarget){case"handle":case"handles":c.displays=c.handles,c.handles[0].addClass("bzm-range-slider-display"),c.dual&&c.handles[1].addClass("bzm-range-slider-display");break;default:c.displays=[b.getElementById(e.displayTarget)]}else c.displays=[];if(e.initial){var a=e.initial.split(",");c.initial=[void 0!==a[0]?parseInt(a[0]):c.notLess,void 0!==a[1]?parseInt(a[1]):c.notMore]}else c.initial=[c.notLess,c.notMore];c.$watch("startAt",function(){c.value<c.startAt,c.startAt&&c.setStart(c.startAt)}),c.$watch("stopAt",function(){c.value>c.stopAt,c.stopAt&&c.setStop(c.stopAt)}),c.initialSettings(c.initial)},c.init()}var d='<div class="bzm-range-slider range-slider" title="{{title}}"data-slider><span class="range-slider-handle handle-min" ng-mousedown="handleCB($event,0)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="handle-max" ng-mousedown="handleCB($event,1)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="range-slider-active-segment"></span><span class="bzm-range-slider-start" ></span> <span class="bzm-range-slider-stop"></span> <input id={{sliderid}} type="hidden"></div>';return{restrict:"E",scope:{startAt:"=",stopAt:"=",callback:"=",formatter:"=",handle:"="},require:"ngModel",template:d,replace:!0,link:c}}var RangeSlider=angular.module("bzm-range-slider",[]);RangeSlider.directive("rangeSlider",["$log","$document","$filter",bzmFoundationSlider]);