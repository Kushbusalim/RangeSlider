"use strict";function RangeSliderHandle(a){var b=[],c=[];this.getId=function(){return a.sliderid},this.getView=function(d){return d||(d=0),a.value[d]===b[d]?c[d]:(b[d]=a.value[d],c[d]=a.formatter?a.formatter(a.value[d],a.sliderid):a.value[d],c[d])},this.getValue=function(b){return b||(b=0),a.value[b]},this.getRelative=function(b){return b||(b=0),a.relative[b]},this.setValue=function(b,c){c||(c=0),a.setValue(b)}}function bzmFoundationSlider(a,b){function c(a,c,d){a.normalize=function(b){var c=a.notMore-a.notLess,d=b*c;if(a.bystep>0){var e=(d-d%a.bystep)/a.bystep,f=d%a.bystep,g=f>=.5*a.bystep?a.bystep:0,h=e*a.bystep+g+a.notLess;return h}if(a.bystep<0){var i=Math.pow(10,-1*a.bystep),h=a.notLess+parseInt(d*i)/i;return h}return d},a.getValue=function(b,c){a.relative[c]=a.vertical?(b-a.bounds.handles[c].height)/(a.bounds.bar.height-a.bounds.handles[c].height):b/(a.bounds.bar.width-a.bounds.handles[c].width);var d=a.normalize(a.relative[c]);d!=a.value[c]&&(a.value[c]=d,a.displays[c]&&a.displays[c].html(a.formatter?a.formatter(d,a.sliderid):d),a.$apply())},a.setStart=function(b){if(a.vertical){var c=a.bounds.bar.height*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("height",c+"px")}else{var c=a.bounds.bar.width*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("width",c+"px")}},a.setStop=function(b){if(a.vertical){var c=a.bounds.bar.height*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("height",c+"px")}else{var c=a.bounds.bar.width*(b-a.notLess)/(a.notMore-a.notLess);a.stop.css({right:0,width:a.bounds.bar.width-c+"px"})}},a.translate=function(b,c){if(a.vertical){var d=a.bounds.bar.height-b;if(a.handles[c].css({"-webkit-transform":"translateY("+d+"px)","-moz-transform":"translateY("+d+"px)","-ms-transform":"translateY("+d+"px)","-o-transform":"translateY("+d+"px)",transform:"translateY("+d+"px)"}),a.dual){if(a.relative[1]&&a.relative[0]){var e=parseInt((a.relative[1]-a.relative[0])*a.bounds.bar.height),f=parseInt(a.relative[0]*a.bounds.bar.height);a.slider.css({bottom:f+"px",height:e+"px"})}}else a.slider.css("height",b+"px")}else if(a.handles[c].css({"-webkit-transform":"translateX("+b+"px)","-moz-transform":"translateX("+b+"px)","-ms-transform":"translateX("+b+"px)","-o-transform":"translateX("+b+"px)",transform:"translateX("+b+"px)"}),a.dual){if(a.relative[1]&&a.relative[0]){var g=parseInt((a.relative[1]-a.relative[0])*a.bounds.bar.width),f=parseInt(a.relative[0]*a.bounds.bar.width);a.slider.css({left:f+"px",width:g+"px"})}}else a.slider.css("width",b+"px")},a.setvalue=function(b,c){var d;b!==a.value[c]&&(void 0===b&&(b=0),b>a.notMore&&(b=a.notMore),b<a.notLess&&(b=a.notLess),a.vertical?(a.relative[c]=(b-a.notLess)/(a.notMore-a.notLess),0===c&&(d=a.relative[c]*a.bounds.bar.height+a.bounds.handles[c].height),1===c&&(d=a.relative[c]*a.bounds.bar.height)):(a.relative[c]=(b-a.notLess)/(a.notMore-a.notLess),d=a.relative[c]*a.bounds.bar.width),a.translate(d,c),a.value[c]=b,a.displays[c]&&(a.formatter?a.displays[c].html(a.formatter(b,a.sliderid)):a.display.html(b)))},a.keydown=function(b){switch(b.keyCode){case 39:case 38:a.bystep>0&&a.$apply(a.setvalue(a.value[a.active]+a.bystep,a.active)),a.bystep<0&&a.$apply(a.setvalue(a.value[a.active]+1/Math.pow(10,-1*a.bystep),a.active));break;case 37:case 40:a.bystep>0&&a.$apply(a.setvalue(a.value[a.active]-a.bystep,a.active)),a.bystep<0&&a.$apply(a.setvalue(a.value[a.active]-1/Math.pow(10,-1*a.bystep),a.active));break;case 27:a.handles[a.active][0].blur()}},a.focusCB=function(c){c?b.on("keypress",a.keydown):b.unbind("keypress",a.keydown)},a.handleCB=function(c,d){function e(b){var c;a.vertical?(c=a.bounds.bar.bottom-b.clientY,c>a.bounds.bar.height&&(c=a.bounds.bar.height),c<a.bounds.handles[d].height&&(c=a.bounds.handles[d].height)):(c=b.clientX-a.bounds.bar.left,c+a.bounds.handles[d].width>a.bounds.bar.width&&(c=a.bounds.bar.width-a.bounds.handles[d].width)),0>c&&(c=0),a.translate(c,d),a.getValue(c,d)}function f(){b.unbind("mousemove",e),b.unbind("mouseup",f),a.callback&&g!==a.value[d]&&a.callback(a.ngModel,a.sliderid)}var g=a.value[d];c.preventDefault(),b.on("mousemove",e),b.on("mouseup",f),a.handles[d][0].focus(),a.active=d},a.find=function(a,b){var d;d=b?b[0].querySelector(a):c[0].querySelector(a);var e=angular.element(d);return e},a.initialSettings=function(b){var d;a.value=[],a.relative=[],null===a.precision&&(d=(""+a.bystep).match(/\.([\d]*)/),a.precision=d&&d[1]?d[1].length:0),a.bounds={bar:c[0].getBoundingClientRect(),handles:[a.handles[0][0].getBoundingClientRect(),a.handles[1][0].getBoundingClientRect()]},a.setvalue(b[0],0),a.dual&&(a.handles[1].addClass("range-slider-handle"),a.setvalue(b[1],1))},a.init=function(){if(a.sliderid=d.id||"range-slide-"+parseInt(1e3*Math.random()),a.bystep=parseInt(d.byStep)||1,a.vertical=d.vertical||!1,a.dual=d.dualHandles||!1,a.trigger_input_change=!1,a.notMore=parseInt(d.notMore)||100,a.notLess=parseInt(d.notLess)||0,d.initial){var e=d.initial.split(",");a.initial=[parseInt(e[0])||a.notLess,parseInt(e[1])||a.notMore]}else a.initial=[a.notLess,a.notMore];if(a.vertical&&c.addClass("vertical-range"),d.format&&(a.format=d.format.split("|")),a.handles=[a.find(".handle-min"),a.find(".handle-max")],a.slider=a.find(".range-slider-active-segment"),a.start=a.find(".bzm-range-slider-start"),a.stop=a.find(".bzm-range-slider-stop"),a.ngModel=new RangeSliderHandle(a),d.displayTarget)switch(d.displayTarget){case"handle":case"handles":a.displays=a.handles,a.handles[0].addClass("bzm-range-slider-display"),a.dual&&a.handles[1].addClass("bzm-range-slider-display");break;default:a.displays=[b.getElementById(d.displayTarget)]}else a.displays=[];a.initialSettings(a.initial),a.$watch("startAt",function(){a.value<a.startAt,a.startAt&&a.setStart(a.startAt)}),a.$watch("stopAt",function(){a.value>a.stopAt,a.stopAt&&a.setStop(a.stopAt)})},a.init()}var d='<div class="bzm-range-slider range-slider" data-slider><span class="range-slider-handle handle-min" ng-mousedown="handleCB($event,0)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="handle-max" ng-mousedown="handleCB($event,1)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="range-slider-active-segment"></span><span class="bzm-range-slider-start" ></span> <span class="bzm-range-slider-stop"></span> <input type="hidden"></div>';return{restrict:"E",scope:{ngModel:"=",startAt:"=",stopAt:"=",callback:"=",formatter:"="},template:d,require:"ngModel",replace:!0,link:c}}var RangeSlider=angular.module("bzm-range-slider",[]);RangeSlider.directive("rangeSlider",["$log","$document","$filter",bzmFoundationSlider]);